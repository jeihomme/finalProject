<?xml version="1.0" encoding="UTF-8"?>

<!--  마이바티스 3 매퍼 Doctype -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <!--  매퍼 설정 -->
<mapper namespace="web.dao.face.MypageDao">

	<select id="selectInfoByUserId"
	parameterType="web.dto.Member"
	resultType="web.dto.Member">
		select
			*
		from member
		where userId = #{userId }
	</select>
	
	<update id="updateInfo"
	parameterType="web.dto.Member">
		update member set email=#{email }, telcom=#{telcom }, contact=#{contact }
		where userId = #{userId }
	</update>
	
<!-- 	public void updateBandMember(List<BandMember> bandMember); -->
	<update id="updateBandMember"
	parameterType="web.dto.BandMember">
		update bandMember set
			bandMemName=#{bandMemName }
			, bandMemInfo=#{bandMemInfo }
		where bandName = #{bandName } and bandMemberNo = #{bandMemberNo }
	</update>

	<update id="updatePw"
	parameterType="web.dto.Member">
		update member set password=#{password }
		where userId = #{userId }
	</update>
	
	<select id="selectUserListCnt" resultType="int">
		select count(*) from member
	</select>

	<select id="selectCntAll" parameterType="String"
		resultType="int">
		select count(*) from member
		WHERE userId LIKE '%'||#{search }||'%'
	</select>
	
	<select id="selectUserList" parameterType="web.utils.Paging"
		resultType="web.dto.Member">
		SELECT * FROM (
		SELECT rownum rnum, B.* FROM (
		SELECT * FROM member
		ORDER BY userId DESC
		) B
		ORDER BY rnum
		)
		WHERE rnum between #{startNo } AND
		#{endNo }
	</select>
	
	<select id="selectUserByUserId" parameterType="web.utils.Paging"
		resultType="web.dto.Member">
		SELECT * FROM (
		 SELECT rownum rnum, B.* FROM (
		 	SELECT * FROM member
			WHERE userId LIKE '%'||#{search }||'%'
		 	ORDER BY userId DESC
		 ) B
		 ORDER BY rnum
		)
		WHERE rnum between #{startNo } AND
		#{endNo }
	</select>
	
	<delete id="deleteUser" parameterType="web.dto.Member">
		delete member
		where userId=#{userId }
	</delete>
	
	<select id="selectBoardList" parameterType="web.utils.Paging"
		resultType="web.dto.Resume">
		SELECT * FROM (
		SELECT rownum rnum, B.* FROM (
		SELECT * FROM resume
		ORDER BY resumeNo DESC
		) B
		ORDER BY rnum
		)
		WHERE rnum between #{startNo } AND
		#{endNo }
	</select>
	
	<select id="selectBoardByResumeNo" parameterType="web.utils.Paging"
		resultType="web.dto.Resume">
		SELECT * FROM (
		 SELECT rownum rnum, B.* FROM (
		 	SELECT * FROM resume
			WHERE resumeNo LIKE '%'||#{search }||'%'
		 	ORDER BY resumeNo DESC
		 ) B
		 ORDER BY rnum
		)
		WHERE rnum between #{startNo } AND
		#{endNo }
	</select>
	
	<delete id="deleteBoard" parameterType="web.dto.Resume">
		delete resume
		where resumeNo=#{resumeNo }
	</delete>
	
	<select id="selectBandByUserId" parameterType="web.dto.Band"
		resultType="web.dto.Band">
		select * from band
		where userId = #{userId }
	</select>
	
	<select id="selectBandMemberByBandName" parameterType="web.dto.BandMember"
		resultType="web.dto.BandMember">
		select
			*
		from bandMember
		where bandName = #{bandName }
		order by bandMemberNo
	</select>
	
<!-- 	public void insertBandMemberList(BandMember bandMember); -->
	<insert id="insertBandMemberList" parameterType="web.dto.BandMember">
		<selectKey keyProperty="bandMemberNo" resultType="int" order="BEFORE">
<!-- 			select dept_seq.nextval from dual -->
			select * from (
			select NVL(max(bandMemberNo)+1, 1) from bandMember
			order by bandMemberNo desc
			)
			where rownum = 1
<!-- 			select max(no)+1 no from test_member -->
		</selectKey>
		insert into BandMember
			values(
			#{bandMemberNo }
			, ''
			, #{bandName }
			, ''
			)
	</insert>
	
<!-- 	public void deleteBandMemberList(BandMember bandMember); -->
	<insert id="deleteBandMemberList" parameterType="web.dto.BandMember">
		<selectKey keyProperty="bandMemberNo" resultType="int" order="BEFORE">
<!-- 			select dept_seq.nextval from dual -->
			select * from (
			select bandMemberNo from bandMember
			order by bandMemberNo desc
			)
			where rownum = 1
<!-- 			select max(no)+1 no from test_member -->
		</selectKey>
		delete BandMember where bandMemberNo = #{bandMemberNo }
	</insert>
</mapper>